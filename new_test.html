<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
    
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>

    <script>
		(function( $ ) {
            // https://learn.jquery.com/plugins/advanced-plugin-concepts/
            
		    $.fn.bsGridEngineer = function(options) {
                // if ($.fn.bsGridEngineer.singletone) return $.fn.bsGridEngineer.singletone;

                var opts = $.extend( {}, $.fn.bsGridEngineer.defaults, options );
                
                //var grideditor = this.data('grideditor');
                
		        var new_row = $.fn.bsGridEngineer.addNewRow(opts["id-main-canvas"], opts["id-row-html"]);
		        var new_col = $.fn.bsGridEngineer.addNewCol(new_row, opts["id-col-html"]);
		        $.fn.bsGridEngineer.setColContent(new_col);
		        
		        // $.fn.bsGridEngineer.singletone = this;
		        return this;
		 
		    };
		    
            $.fn.bsGridEngineer.addNewRow = (target, source_row_container) => {
                // console.log("start addNewRow");
                var row_el = $( $(source_row_container || $.fn.bsGridEngineer.defaults["id-row-html"]).html() );

                // add unique row rel attribute
                var rel_id = (new Date().getTime() + '.Rrnd' + Math.floor(Math.random() * 1000));
                row_el.find('[name^="SRB"]').each((i,e) => {
                    $(e).attr("rel", rel_id);
                });
                row_el.attr("rel", rel_id);


                // var uniq_id = (new Date().getTime() + '.rnd' + Math.floor(Math.random() * 1000));
                // row_el.filter("div[name=\"SRB-CONTENT\"]").attr("id", uniq_id);
                // row_el.removeClass("d-none");
                $(target).append(row_el);
                return row_el.find("div[name=\"SRB-CONTENT\"][rel=\""+rel_id+"\"]");
            };

            $.fn.bsGridEngineer.addNewCol = (target, source_col_container) => {
                var col_el = $( $(source_col_container || $.fn.bsGridEngineer.defaults["id-col-html"]).html() );

                // add unique col rel attribute
                var rel_id = (new Date().getTime() + '.Crnd' + Math.floor(Math.random() * 1000));
                col_el.find('[name^="SCB"]').each((i,e) => {
                    $(e).attr("rel", rel_id);
                });
                col_el.attr("rel", rel_id);

                var rel_target = $(target).attr("rel");
                col_el.attr("alt", rel_target);

                var expect_width = 0; var max_width = 12;
                $(target).find("div[name=\"SCB\"][alt=\""+rel_target+"\"]").each((i,e) => {
                    var classList = $(e).attr('class').split(/\s+/);
                    $.each(classList, (index, class_name) => {
                        var matches = class_name.match(/^col\-(\d+)$/);
                        if (matches) {
                            var sum_len = expect_width + matches[1];
                            if (sum_len > max_width) {
                                expect_width = max_width - matches[1];
                            } else if (sum_len === max_width) {
                                expect_width = 0;
                            } else {
                                expect_width = max_width - sum_len;
                            }
                        }
                    });

                    // lets be bigger
                    if (expect_width !== 0 && expect_width < 2) expect_width = 2; 
                });

                if (expect_width) {
                    var default_class = "col-8";
                    col_el.removeClass(default_class);
                    col_el.addClass("col-" + expect_width);
                }

                // col_el.removeClass("d-none");
                $(target).append(col_el);
                return col_el.find("div[name=\"SCB-CONTENT\"][rel=\""+rel_id+"\"]");
            };

            $.fn.bsGridEngineer.setColContent = (col) => {
                $(col).append($("#COL-DEFAULT-CONTENT").html());
                return;
            };

		    $.fn.bsGridEngineer.defaults = {
		        "id-main-canvas": "#BS-MAIN-CANVAS",
		        "id-row-html": "#SOURCE-ROW-BLOCK",
		        "id-col-html": "#SOURCE-COL-BLOCK"
		    };
		    
		    function debug() {
		        // set prefix
		        if ( window.console && window.console.log ) {
                    var args = [...arguments];
                    args.unshift("bsGridEngineer:"); 
                    console.debug.apply(null, args);
		        }
		    };
		    
		}( jQuery ));
		
		
		$( document ).ready(function() {
		    //$("body div.container div.container-fluid").bsGridEngineer();
		    $().bsGridEngineer();
		    
		    
		});
		
        function addRowOverButton(el) {
            var target_el = $(el);
            var new_row = jQuery().bsGridEngineer.addNewRow(target_el);
            addColOverButton(new_row);
            //var new_col = jQuery().bsGridEngineer.addNewCol(new_row);
            //jQuery().bsGridEngineer.setColContent(new_col);

            return;
        }

        function addColOverButton(row) {
            var row = $(row);
            var new_col = jQuery().bsGridEngineer.addNewCol(row);
            jQuery().bsGridEngineer.setColContent(new_col);

            return;
        }

        function removeColOverButton(col) {
            var col = $(col);
            var col_rel = col.attr("rel");

            var row_rel = $("div[name=\"SCB\"][rel=\""+col_rel+"\"]").attr("alt");
            var all_calls = $("div[name=\"SRB\"][rel=\""+row_rel+"\"]").find("div[name=\"SCB\"][alt=\""+row_rel+"\"]");
            if (all_calls && all_calls.length > 1) {
                $("div[name=\"SCB\"][rel=\""+col_rel+"\"]").remove();
            } else {
                $("div[name=\"SRB\"][rel=\""+row_rel+"\"]").remove();
            }

            return;
        }       

        function extendColOverButton(col) {
            var col = $(col);
            var classList = $(col).attr('class').split(/\s+/);
            $.each(classList, (index, class_name) => {
                var matches = class_name.match(/^col\-(\d+)$/);
                if (matches) {
                    if (matches[1] < 12) {
                        col.removeClass(class_name);
                        col.addClass("col-" + (parseInt(matches[1]) + 1));
                    }
                }
            });
        }

        function shrinkColOverButton(col) {
            var col = $(col);
            var classList = $(col).attr('class').split(/\s+/);
            $.each(classList, (index, class_name) => {
                var matches = class_name.match(/^col\-(\d+)$/);
                if (matches) {
                    if (matches[1] > 1) {
                        col.removeClass(class_name);
                        col.addClass("col-" + (parseInt(matches[1]) - 1));
                    }
                }
            });
        }

    </script>
    
    <style>
    </style>
    
  </head>
  <body>
<div class="container">
	<h3>
        &#8801; bsGridEngineer
        <small class="text-muted">very simple editor for the bootstrap grid system</small>
        <button type="button" class="btn btn-outline-dark btn-sm" style="font-size: 37%; font-weight: bolder;"
            onclick='addRowOverButton("#BS-MAIN-CANVAS");' 
        >
            <div class="container-fluid">
	            <div class="row">
	                <div class="col"><span style="font-size: 120%;">+</span> row</div>
	            </div>
	        </div>
	    </button>
	</h3>
	
	<div class="container-fluid p-0 " id="BS-MAIN-CANVAS"></div>
	
</div>    
    
<!-- SOURCE-ROW-BLOCK -->
    <div class="container-fluid p-1 d-none" id="SOURCE-ROW-BLOCK">
        <div class="container-fluid" name="SRB">
            <div class="row border border-secondary border-bottom-0" style="background-color: #f4f4f4; border-color: #999; color: #666;">
                <div class="col-8 p-1">
                    <button type="button" class="btn btn-outline-dark btn-sm" style="font-size: 67%; font-weight: bolder;"  name="SRB-ADD-COL"
                        onclick='addColOverButton( $("div[name=\"SRB-CONTENT\"][rel=\""+$(this).attr("rel")+"\"]") )'
                    >
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col"><span style="font-size: 120%;">+</span> col</div>
                            </div>
                        </div>
                    </button>
                </div>
                <div class="col-4 p-1 text-right">
                    <button type="button" class="btn btn-outline-dark btn-sm" style="font-weight: bolder;" name="SRB-CLOSE"
                        onclick='$("div[name=\"SRB\"][rel=\""+$(this).attr("rel")+"\"]").remove();'
                    >
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col">&times;</div>
                            </div>
                        </div>
                    </button>
                </div>
            </div>
            <div class="row p-1 border border-secondary border-top-0" style="background-color: white; border-color: #999; color: #666;" name="SRB-CONTENT">
            </div>
        </div>
    </div>
    
<!-- /SOURCE-ROW-BLOCK -->

<!-- SOURCE-COL-BLOCK -->

    <div class="container-fluid p-1 d-none" id="SOURCE-COL-BLOCK">
        <div class="col-8 border border-secondary" style="background-color: white; border-color: #999; color: #666;" name="SCB">
            <div style="display: none;" name="SCB-PARENT-ROW" alt=""></div>
	        <div class="row" style="background-color: #f4f4f4; border-color: #999; color: #666;">
	            <div class="col-8 p-1">
                    <button type="button" class="btn btn-outline-dark btn-sm" style="font-size: 67%; font-weight: bolder;" name="SCB-ADD-ROW"
                        onclick='addRowOverButton( $("div[name=\"SCB-CONTENT\"][rel=\""+$(this).attr("rel")+"\"]") )'
                    >
	                    <div class="container-fluid">
	                        <div class="row">
	                            <div class="col"><span style="font-size: 120%;">+</span> row</div>
	                        </div>
	                    </div>
	                </button>
	                <button type="button" class="btn btn-outline-dark btn-sm" style="font-size: 67%; font-weight: bolder;" name="SCB-EXTEND"
                        onclick='extendColOverButton( $("div[name=\"SCB\"][rel=\""+$(this).attr("rel")+"\"]") )'
                    >
	                    <div class="container-fluid">
	                        <div class="row">
	                            <div class="col"><span style="font-size: 120%;">&#8592; &#8594;</span></div>
	                        </div>
	                    </div>
	                </button>
                    <button type="button" class="btn btn-outline-dark btn-sm" style="font-size: 67%; font-weight: bolder;" name="SCB-SHRINK"
                        onclick='shrinkColOverButton( $("div[name=\"SCB\"][rel=\""+$(this).attr("rel")+"\"]") )' 
                    >
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col"><span style="font-size: 120%;">&#8594;&#8226;&#8592;</span></div>
                            </div>
                        </div>
                    </button>
	            </div>
	            <div class="col-4 p-1 text-right">
	                <button type="button" class="btn btn-outline-dark btn-sm" style="font-weight: bolder;" name="SCB-CLOSE"
                        onclick='removeColOverButton(this)'
                    >
	                    <div class="container-fluid">
	                        <div class="row">
	                            <div class="col">&times;</div>
	                        </div>
	                    </div>
	                </button>
	            </div>
	        </div>
	        <div class="row p-1" style="background-color: white; border-color: #999; color: #666;" name="SCB-CONTENT">
	        </div>
        </div>
    </div>
    
<!-- /SOURCE-COL-BLOCK -->

<!-- COL-DEFAULT-CONTENT -->

    <div class="container-fluid p-1 d-none" id="COL-DEFAULT-CONTENT">
        Content<br>
        Content<br>
        Content<br>
        Content
    </div>
    
<!-- /COL-DEFAULT-CONTENT -->


    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
	<!--
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
    -->
  </body>
</html>